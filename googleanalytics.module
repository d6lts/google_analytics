<?php
/* Drupal Module: GoogleAnalytics
 * Adds the required Javascript to the top of all your Drupal pages
 * to allow tracking by the Google Analytics statistics package.
 *
 * @author: Mike Carter <mike@ixis.co.uk>
 */

/**
 * Implementation of hook_help().
 */
function googleanalytics_help($section) {
  switch ($section) {
    case 'admin/modules#description':
      return t('Adds tracking code to all pages of your site');
   case 'admin/settings/googleanalytics':
      return t('Google Analytics is a free statistics package based on the excellent Urchin system.');
  }
}

function googleanalytics_menu($may_cache) {
  if(!$may_cache) {
    $id = variable_get('googleanalytics_account', '');

    if($id != '') {
      $output = '<script type="text/javascript">_uacct = "'.$id.'";urchinTracker();</script>';

      drupal_add_js('http://www.google-analytics.com/urchin.js');
      drupal_set_html_head($output);
    }
  }
}


/**
 * Implementation of hook_settings().
 */
function googleanalytics_settings() {
  $form['account'] = array(
        '#type' => 'fieldset',
        '#title' => t('Analytics Account Settings'),
        '#collapsible' => FALSE,
      );

  $form['account']['googleanalytics_account'] = array(
      '#type' => 'textfield',
      '#title' => t('User ID'),
      '#default_value' => variable_get('googleanalytics_account',''),
      '#size' => 15,
      '#maxlength' => 20,
      '#required' => TRUE,
      '#description' => t('The user account is unique to the websites domain. You can obtain a user account from the %url website.', array('%url' => '<a href="http://www.google.com/analytics/">Google Analytics</a>'))
    );

  return $form;
}
?>